<mat-card>
  <mat-card-content>
    <form class="user-form" #userForm="ngForm" appPasswordConfirmationValidator>
      <div class="user-form__row">
        <mat-form-field>
          <mat-label>Nome</mat-label>
          <input type="text" name="nome" required matInput [(ngModel)]="userSelected.name" />
          <mat-error>O <strong>Nome</strong> é obrigatório.</mat-error>
        </mat-form-field>
      </div>
      <div class="user-form__row">
        <mat-form-field>
          <mat-label>Usuário</mat-label>
          <input 
            type="text" 
            name="usuario" 
            required 
            matInput 
            [(ngModel)]="userSelected.username"
            [ngModelOptions]="{updateOn: 'blur'}" 
            #usuarioControl="ngModel" 
            appCredentialsValidator="username"
          />

          <mat-hint>O <strong>Usuário</strong> será usado para login.</mat-hint>

          @if(usuarioControl.hasError('required')){
            <mat-error>O <strong>Usuário</strong> é obrigatório.</mat-error>
          }

          @if(!usuarioControl.hasError('required') && usuarioControl.hasError('invalidUserName')){
            <mat-error>Este <strong>Usuário</strong> já está sendo utilizado.</mat-error>
          }
        </mat-form-field>

        <mat-form-field>
          <mat-label>E-mail</mat-label>
          <input 
            type="text" 
            name="email" 
            required 
            matInput 
            [(ngModel)]="userSelected.email"
            [ngModelOptions]="{ updateOn: 'blur' }" 
            #emailControl="ngModel" 
            appEmailPatternValidator 
            appCredentialsValidator="email"
          />

          @if(emailControl.hasError('required')){
            <mat-error>O <strong>E-mail</strong> é obrigatório.</mat-error>
          }

          @if(!emailControl.hasError('required') && emailControl.hasError('invalidEmail')){
            <mat-error>O<strong> E-mail</strong> está inválido.</mat-error>
          }

          @if(!emailControl.hasError('required') && !emailControl.hasError('invalidEmail') && emailControl.hasError('invalidUserEmail')){
            <mat-error>Este <strong>E-mail</strong> já está sendo utilizado.</mat-error>
          }
        </mat-form-field>
      </div>
      <div class="user-form__row">
        <mat-form-field>
          <mat-label>Senha</mat-label>
          <input 
            type="password" 
            name="senha" 
            required 
            matInput 
            [(ngModel)]="userSelected.password" 
            (ngModelChange)="onPasswordChange($event)"
            #passwordControl="ngModel"
            appPasswordStrengthValidator
          />

          <mat-progress-bar mode="determinate" [value]="passwordStrength.value" [color]="passwordStrength.color"></mat-progress-bar>
          
          @if(passwordControl.valid){
            <mat-hint>Sua <strong>Senha</strong> está {{passwordStrength.label}}.</mat-hint>
          }

          @if(passwordControl.hasError('required')){
            <mat-error>A <strong>Senha</strong> é obrigatória.</mat-error>
          }

          @if(passwordControl.hasError('invalidPasswordStrength')){
            <mat-error><strong>Senha</strong> {{passwordStrength.label}}. Use uma senha mais forte.</mat-error>
          }
        </mat-form-field>
        <mat-form-field>
          <mat-label>Confirmar a senha</mat-label>
          <input 
            type="password" 
            name="confirmacaoSenha" 
            required 
            matInput 
            ngModel
            #passwordConfirmationControl="ngModel"
          />

          @if(passwordConfirmationControl.hasError('required')){
            <mat-error>A confirmação da <strong>Senha</strong> é obrigatória.</mat-error>
          }

          @if(!passwordConfirmationControl.hasError('required') && passwordConfirmationControl.hasError('invalidPasswordConfirmation')){
            <mat-error><strong>Senha</strong> incorreta.</mat-error>
          }
        </mat-form-field>
      </div>
      <div class="user-form__row">
        <mat-form-field>
          <mat-label>Data de nascimento</mat-label>
          <input 
            type="text" 
            name="dataNascimento" 
            required 
            readonly
            matInput 
            [min]="minDate" 
            [max]="maxDate"
            [matDatepicker]="datepicker"
            [ngModel]="dateValue" 
            (ngModelChange)="onDateChange($event)"
          />

          <mat-hint>MM/DD/YYYY</mat-hint>
          <mat-datepicker-toggle matIconSuffix [for]="datepicker"></mat-datepicker-toggle>
          <mat-datepicker #datepicker>
            <mat-datepicker-actions>
              <button mat-button matDatepickerCancel>Cancelar</button>
              <button mat-raised-button color="primary" matDatepickerApply>Confirmar</button>
            </mat-datepicker-actions>
          </mat-datepicker>

          <mat-error>O <strong>data de nascimento</strong> é obrigatório.</mat-error>
        </mat-form-field>
      </div>
    </form>
  </mat-card-content>
</mat-card>